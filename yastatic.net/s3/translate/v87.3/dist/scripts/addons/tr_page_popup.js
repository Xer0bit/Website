!function(t,e,n){"use strict";var i=function(t,e){for(;t&&t.nodeType===Node.ELEMENT_NODE;){if(e(t))return t;t=t.parentNode}return null},o=function(t){let e=[];for(;t&&"BODY"!==t.nodeName;)e.push(t.className),t=t.parentNode;return e},s=function(t){this._element=t,this._pointer={x:0,y:0},this._popupPosition={x:0,y:0}};s.getViewportRect=function(){return{top:t.pageYOffset,left:t.pageXOffset,width:e.documentElement.clientWidth,height:e.documentElement.clientHeight}},s.isElementStatic=function(e){return"static"===t.getComputedStyle(e,null).getPropertyValue("position")},s.getParentOffset=function(){var t,n,i=0,o=0,s=this.getViewportRect();return this.isElementStatic(e.body)?(this.isElementStatic(e.documentElement)||(i+=(n=e.documentElement.getBoundingClientRect()).left+s.left,o+=n.top+s.top),{x:i,y:o}):{x:i+=(t=e.body.getBoundingClientRect()).left+s.left,y:o+=t.top+s.top}},s.prototype.moveTo=function(t,e){this._element.style.top=e+"px",this._element.style.left=t+"px"},s.prototype.getElementRect=function(){return this._element.getBoundingClientRect()},s.prototype.isSizeValid=function(t){var e=this.getElementRect();return t.height!==e.height||t.width!==e.width},s.prototype.calculatePosition=function(t,e,n){var i=0,o=0;t.forEach((function(t,e){i=e>0?Math.min(i,t.left):t.left,o=e>0?Math.max(o,t.bottom):t.bottom})),i+e.width>n.width&&(i=n.width-e.width),o+e.height>n.height&&(o=n.height-e.height),this._popupPosition.x=i,this._popupPosition.y=o},s.prototype.updatePosition=function(t){var e,n=this.getElementRect(),i=s.getViewportRect(),o=s.getParentOffset();return e=this.calculatePosition(t,n,i),this.moveTo(this._popupPosition.x+i.left-o.x,this._popupPosition.y+i.top-o.y),this.isSizeValid(n)&&(e=this.updatePosition(t)),e},s.prototype.setPointerCoords=function(t,e){this._pointer.x=t,this._pointer.y=e};var a=function t(n){var i,o;this._showTimer=0,this._hideTimer=0,n=n||{},this.setElement(n.element),this._spanType=n.spanType||"",this._hideDelay=n.hideDelay||t.DEFAULT_HIDE_DELAY,this._showDelay=n.showDelay||t.DEFAULT_SHOW_DELAY,this._inputElement=n.inputElement||e.createElement("input"),this._contentElement=n.contentElement||e.createElement("div"),this._positionBehavior=n.positionBehavior||new s(this._element),this._handleDocumentEvent=(i=this._handleDocumentEvent,o=this,function(){return i.apply(o,arguments)}),this._updateDocumentEvents()};a.ACTION_OPEN="open",a.ACTION_SEND="send",a.ACTION_CLOSE="close",a.ACTION_CLICK_CLOSE="clickClose",a.ACTION_EXPAND="expand",a.ACTION_DISLIKE="dislike",a.ACTION_COMMENT="comment",a.ACTION_ORIGINAL="original",a.STATE_DISABLED="disabled",a.STATE_EXPANDED="expanded",a.STATE_HIDDEN="hidden",a.STATE_INVALID="invalid",a.STATE_COMMENT="comment",a.STATE_POSITION="position",a.STATE_SUBMITTED="submitted",a.STATE_TRANSLATOR="translator",a.STATE_TRANSLATION="translation",a.ERROR_TYPE_ORIGINAL="original",a.DEFAULT_SHOW_DELAY=800,a.DEFAULT_HIDE_DELAY=400,a.PositionBehavior=s,a.prototype.show=function(e){var n=this;t.clearTimeout(this._hideTimer),e&&e!==this._spanIndex&&!this.isExpanded()&&(this._showTimer=t.setTimeout((function(){n.setIndex(e)}),this._showDelay))},a.prototype.hide=function(e){var n=this;t.clearTimeout(this._showTimer),this.isHidden()||this.isExpanded()&&!e||(this._hideTimer=t.setTimeout((function(){n.setIndex()}),e?0:this._hideDelay))},a.prototype.onAction=function(){},a.prototype.isHidden=function(){return"true"===this.getData(a.STATE_HIDDEN)},a.prototype.setFocus=function(t){this._inputElement[t?"focus":"blur"]()},a.prototype.setInputScroll=function(t,e){this._inputElement.scrollTop=t,this._inputElement.scrollLeft=e},a.prototype.getValue=function(){return this._inputElement.value.trim()},a.prototype.setValue=function(t){this._inputElement.value=t},a.prototype.getSpans=function(){return this._spanType&&this._spanIndex?Array.apply(null,e.querySelectorAll('[data-type="'+this._spanType+'"][data-index="'+this._spanIndex+'"]')):[]},a.prototype.setIndex=function(t){var e="",n="";this.highlightIndex(),this._spanIndex=t,t&&(this.getSpans().forEach((function(t){e+=t.getAttribute("data-value"),n+=t.getAttribute("data-translation")})),e=e.trim(),n=n.trim(),this.setData(a.STATE_TRANSLATION,n),this.setValue(n),this.setContent(e),this.highlightIndex(!0),this.updatePosition(),this.handleAction(a.ACTION_OPEN))},a.prototype.getData=function(t){return this._element.getAttribute("data-"+t)},a.prototype.setData=function(t,e){var n=this.getData(t);this._element.setAttribute("data-"+t,e),n!==this.getData(t)&&this.onDataChange(t,e)},a.prototype.isInvalid=function(){return"true"===this.getData(a.STATE_INVALID)},a.prototype.getContent=function(){return this._contentElement.textContent},a.prototype.setContent=function(t){this._contentElement.textContent=t},a.prototype.setInvalid=function(t){this.setData(a.STATE_INVALID,!!t)},a.prototype.setElement=function(t){var n=this;(t=this._element=t||e.createElement("div")).addEventListener("input",(function(){var t=n.getValue();n.setInvalid(!t||t===n.getTranslation())}),!1),t.addEventListener("click",(function(t){var e=i(t.target,(function(t){return t.hasAttribute("data-action")}));e&&n.handleAction(e.getAttribute("data-action"))}),!1),t.addEventListener("mouseout",(function(){n.hide()}),!1),t.addEventListener("mouseover",(function(){n.show()}),!1)},a.prototype.handleAction=function(t){var e={};switch(t){case a.ACTION_SEND:if(this.isInvalid())return;e.text=this.getContent(),e.proposal=this.getValue(),e.translation=this.getTranslation(),e.comment=this.isComment(),!e.comment&&this.isTranslatorFlagEnabled()&&this.replaceSpanValue(e);break;case a.ACTION_ORIGINAL:e.text=this.getContent(),e.proposal=this.getContent(),e.translation=this.getTranslation(),e.type=a.ERROR_TYPE_ORIGINAL,this.replaceSpanValue(e),this.hide(!0);break;case a.ACTION_DISLIKE:var n=this.getSpans()||[];e.text=this.getContent(),e.dislike=!0,e.classList=o(n[0]),e.translation=this.getTranslation(),this.hide(!0);break;case a.ACTION_COMMENT:this.setValue(""),this.setData(a.STATE_COMMENT,!0),e.expanded=this.toggleExpand(),this.updatePosition();break;case a.ACTION_CLOSE:this.hide(!0);break;case a.ACTION_EXPAND:this.setData(a.STATE_COMMENT,!1),e.expanded=this.toggleExpand(),this.updatePosition()}this.onAction(t,e)},a.prototype.replaceSpanValue=function(t){this.getSpans().forEach((function(e,n){0===n?(t.classList=o(e),e.setAttribute("data-value",t.text),e.setAttribute("data-translation",t.translation),e.setAttribute("translate","no"),e.textContent=t.proposal+" ",e.setAttribute("data-edited",!0)):e.remove()}))},a.prototype.isExpanded=function(){return"true"===this.getData(a.STATE_EXPANDED)},a.prototype.isDisabled=function(){return"true"===this.getData(a.STATE_DISABLED)},a.prototype.isComment=function(){return"true"===this.getData(a.STATE_COMMENT)},a.prototype.isTranslatorFlagEnabled=function(){return"true"===this.getData(a.STATE_TRANSLATOR)},a.prototype.setValueDir=function(t){this._inputElement.dir=t},a.prototype.setDisabled=function(t){this.setData(a.STATE_DISABLED,!!t),this._updateDocumentEvents()},a.prototype.toggleExpand=function(t){var e=arguments.length?!!t:!this.isExpanded();return this.setData(a.STATE_EXPANDED,e),e},a.prototype.onDataChange=function(){},a.prototype.setContentDir=function(t){this._contentElement.dir=t},a.prototype.highlightIndex=function(t){this.setInvalid(!0),this.toggleExpand(!1),this.setData(a.STATE_HIDDEN,!t),this.getSpans().forEach((function(e){e.setAttribute("data-selected",!!t)}))},a.prototype.getTranslation=function(){return this.getData(a.STATE_TRANSLATION)||""},a.prototype.updatePosition=function(){var t=this._positionBehavior.updatePosition(this.getSpans().map((function(t){return t.getBoundingClientRect()})));t&&this.setData(a.STATE_POSITION,t)},a.prototype._handlePointerEvent=function(t){t.ignorePointerTracking||this._positionBehavior.setPointerCoords(t.clientX,t.clientY)},a.prototype._handleDocumentEvent=function(t){var e=this._spanType,n=i(t.target,(function(t){return t.getAttribute("data-type")===e}));n&&("mouseout"===t.type?this.hide():(this.show(n.getAttribute("data-index")),this.isExpanded()||this._handlePointerEvent(t)))},a.prototype._updateDocumentEvents=function(){var t=(this.isDisabled()?"remove":"add")+"EventListener";e[t]("mouseout",this._handleDocumentEvent,!1),e[t]("mouseover",this._handleDocumentEvent,!1)},n.PageTranslatorPopup=a}(this,this.document,this.yt=this.yt||{});