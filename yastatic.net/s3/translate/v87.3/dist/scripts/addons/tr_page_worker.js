!function(t,e,a){"use strict";a.worker={events:{load:t,beforeunload:t,resize:t,scroll:t,message:t,DOMContentLoaded:e},userScroll:!0,translator:null,initialize:function(e){var a=this.events;e=e||{},Object.keys(a).forEach((function(t){a[t].addEventListener(t,this,!1)}),this),e.href=t.location.href,navigator.serviceWorker&&navigator.serviceWorker.register(t.location.origin+"/downloader-service-worker.js").then((function(){return navigator.serviceWorker.ready})).then((function(a){if(a&&a.active){var s=JSON.stringify({url:e.originalUrl,proxy:t.location.href});a.active.postMessage(s)}})),this.sendMessage("inited",e)},loadHandler:function(){this.sendMessage("loaded")},handleEvent:function(t){this[t.type+"Handler"](t)},sendMessage:function(e,a){t.parent.postMessage(JSON.stringify({type:e,data:a}),"*")},beforeunloadHandler:function(){var t=this.events;this.sendMessage("unloading",{body:e.body.outerHTML,sid:a.config.sid}),this.translator&&(this.translator.halt(),this.translator=null),Object.keys(t).forEach((function(e){t[e].removeEventListener(e,this,!1)}),this)},scrollHandler:function(){var t=this.getScrollInfo();this.userScroll?this.sendMessage("scrolling",{x:t.x/(t.W-t.w),y:t.y/(t.H-t.h)}):this.userScroll=!0},resizeHandler:function(){var t=e.body,a={};t&&(a.height=Math.max(t.scrollHeight,t.offsetHeight)),this.sendMessage("resized",a)},getScrollInfo:function(){var a="BackCompat"===e.compatMode?e.body:e.documentElement;return{x:t.pageXOffset||a.scrollLeft,y:t.pageYOffset||a.scrollTop,w:a.clientWidth,h:a.clientHeight,W:a.scrollWidth,H:a.scrollHeight}},messageHandler:function(e){var s,r,n=this,o=e.data;try{o=JSON.parse(o)}catch(t){o=null}if(o)switch(o.type){case"undo":this.translator&&this.translator.undo();break;case"redo":this.translator&&this.translator.redo();break;case"halt":this.translator&&this.translator.halt();break;case"start":a.trDir=[o.data.sourceLang,o.data.targetLang].join("-"),this.translator&&(this.translator.undo(),this.translator.translate(o.data.sourceLang,o.data.targetLang));break;case"create":if(this.translator)break;r=Object.assign({},a.config,o.data),this.translator=new a.PageTranslator(r),this.translator.on("complete",(function(){n.sendMessage("complete")})).on("progress",(function(t){n.sendMessage("progress",t)})).on("error",(function(t){n.sendMessage("partialError",t)})),r.useAlign&&!r.disablePopup&&a.createPopup(this.translator,r.translatorFlag);break;case"rename":t.name=o.data;break;case"scroll":this.userScroll=!1,s=this.getScrollInfo(),t.scroll(o.data.x*(s.W-s.w),o.data.y*(s.H-s.h));break;case"highlightChunks":this.translator&&this.translator.highlightChunks()}},DOMContentLoadedHandler:function(){var t=e.body,a={};t&&(a.height=Math.max(t.scrollHeight,t.offsetHeight)),this.sendMessage("ready",a)}}}(this,this.document,this.yt=this.yt||{});